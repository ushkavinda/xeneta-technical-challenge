- name: Create postgres DB container
  docker_container:
    name: dev-db
    recreate: yes
    image: postgres:13.5
    ports:
    - "5432:5432"
    networks:
    - name: "rates-app-network"
      aliases:
        - "{{ docker_network_alias }}"
    env:
       POSTGRES_HOST_AUTH_METHOD: trust

- name: Wait until DB is ready
  pause:
    seconds: 5

- name: Validate DB
  shell: "psql -h localhost -U postgres -c \"SELECT 'alive'\""

- name: Restore DB backup
  shell: "psql -h localhost -U postgres < {{ doc_root }}/db/rates.sql"